
> so what can I do with this?  How can I configure claude code to use it?  How can I prevent MCP/Playwright from taking up context?

⏺ Great questions! Let me explain how to use this project and optimize your Claude Code setup.

  What You Can Do With This Project

  1. Replace MCP Servers with Code-First Approach

  Instead of loading massive MCP tool definitions, you can:

  // AI agents explore the filesystem
  // ls ./tools/system-monitor/

  // Then write code directly:
  import { getSystemInfo, getMemoryInfo } from './tools/system-monitor';

  async function checkHealth() {
    const sys = await getSystemInfo();
    const mem = await getMemoryInfo();

    if (mem.usage_percent > 90) {
      return { alert: 'High memory!', value: mem.usage_percent };
    }
    return { status: 'ok' };
  }

  2. Extend for Your Server Monitoring

  You mentioned monitoring workstations/servers. Add to src/lib.rs:

  #[wasm_bindgen]
  impl SystemMonitor {
      pub fn list_online_hosts(&self) -> String {
          // Call your REST introspection service
          // Return JSON array of hosts
      }

      pub fn get_host_metrics(&self, host: &str) -> String {
          // Query: free disk, memory, GPU, temp, OS, uptime
          // Return summary (not full data dump)
      }
  }

  Then expose via TypeScript in tools/:

  export async function listOnlineHosts(): Promise<Host[]> {
    const json = monitor!.list_online_hosts();
    return JSON.parse(json);
  }

  AI agents discover and use with 2,000 tokens instead of 150,000!

  How to Configure Claude Code to Use It

  Option 1: Project-Specific Tools (Recommended)

  Create a .claude/ directory in your project:

  mkdir -p .claude/tools

  Add a tool definition that tells Claude Code about the code-first approach:

  # .claude/tools/system-monitor.md
  ---
  name: system-monitor
  description: Code-first system monitoring - explore ./tools/system-monitor/ and write TypeScript code
  ---

  # System Monitor Tool

  Instead of calling MCP tools, write code:

  1. Explore: `ls ./tools/system-monitor/`
  2. Read API: `cat ./tools/system-monitor/index.ts`
  3. Write code that imports and uses functions

  Example:
  ```typescript
  import { getSystemInfo, getMemoryInfo } from './tools/system-monitor';

  const info = await getSystemInfo();
  console.log(`Running ${info.os} ${info.os_version}`);

  This uses ~2,000 tokens instead of ~150,000 tokens from MCP!

  ### Option 2: Tell Claude Code in CLAUDE.md

  Add to your `CLAUDE.md`:

  ```markdown
  # CLAUDE.md

  ## Tools Available

  This project uses a **code-first approach** instead of MCP servers:

  - **System Monitor**: See `tools/system-monitor/index.ts`
    - Don't load MCP tool definitions
    - Instead, read the TypeScript file and write code
    - Token savings: 98.7% (150K -> 2K tokens)

  ## How to Use Tools

  1. Explore `./tools/` directory
  2. Read the specific tool's `index.ts` file
  3. Write TypeScript code that imports and uses functions
  4. Process data locally, return only summaries

  Example:
  ```typescript
  import { getMemoryInfo } from './tools/system-monitor';
  const mem = await getMemoryInfo();
  if (mem.usage_percent > 90) console.warn('High memory!');

  ## How to Prevent MCP/Playwright from Taking Up Context

  ### Solution 1: Selective MCP Loading (Quick Fix)

  Instead of loading Playwright globally, only load it when needed:

  ```bash
  # Remove global Playwright MCP
  claude mcp remove playwright

  # Only load for specific projects
  cd /path/to/ui-testing-project
  claude mcp add playwright -s project -- npx -y @playwright/mcp

  Solution 2: Disable Unused MCP Servers

  Check what's loaded:

  claude mcp list

  Remove what you don't need:

  # Remove servers you're not using
  claude mcp remove <server-name>

  Solution 3: Use Code-First Playwright Alternative

  Create your own lightweight testing wrapper:

  // tools/ui-testing/index.ts
  import { Browser } from './browser-wasm'; // Your WASM browser automation

  export async function testLogin(url: string): Promise<TestResult> {
    // Run test, return pass/fail
    // NOT the entire DOM
    return { passed: true, errors: [] };
  }

  Then AI agents write:

  import { testLogin } from './tools/ui-testing';
  const result = await testLogin('http://localhost:3000');
  // Uses minimal tokens!

  Solution 4: Lazy MCP Loading Pattern

  Create a hook that only loads MCP when explicitly requested:

  # .claude/hooks/mcp-loader.sh
  #!/bin/bash

  # Only load Playwright if user asks for UI testing
  if echo "$1" | grep -qi "test.*ui\|playwright\|browser"; then
    echo "Loading Playwright MCP (on-demand)..."
    # Load MCP dynamically
  fi

  Solution 5: Context Budget Monitoring

  Track token usage and disable heavy tools:

  Add to your CLAUDE.md:

  ## Context Budget Rules

  - **Never** load Playwright MCP unless explicitly testing UI
  - **Always** use code-first approach for system monitoring
  - **Prefer** filesystem exploration over tool definition loading
  - **Limit** MCP usage to only critical, non-replaceable tools

  Practical Setup for Your Use Case

  Based on your server monitoring needs, here's the recommended setup:

  1. Build Your Monitoring Tools

  cd rust-wasm-monitor

  # Add your server monitoring functions to src/lib.rs
  # Add GPU, temperature, network stats, etc.

  # Rebuild
  ./build.sh

  2. Create Project Structure

  your-monitoring-project/
  ├── .claude/
  │   └── tools/
  │       └── server-monitor.md  # Tool description
  ├── tools/
  │   ├── system-monitor/        # From rust-wasm-monitor
  │   ├── gpu-monitor/           # Your GPU detection
  │   └── network-monitor/       # Your network stats
  ├── pkg/                       # WASM output
  └── CLAUDE.md                  # Project context

  3. Configure CLAUDE.md

  # Server Monitoring Project

  ## Tools Philosophy

  **Code-First Approach**: No MCP servers for monitoring.

  Available tools (explore via filesystem):
  - `tools/system-monitor/` - OS, memory, disk, CPU
  - `tools/gpu-monitor/` - GPU type, VRAM
  - `tools/network-monitor/` - Interfaces, bandwidth

  ## Usage Pattern

  ```typescript
  import * as sys from './tools/system-monitor';
  import * as gpu from './tools/gpu-monitor';

  async function monitorAllHosts() {
    const hosts = await sys.listOnlineHosts();

    for (const host of hosts) {
      const metrics = await Promise.all([
        sys.getMemoryInfo(host),
        gpu.getGPUInfo(host),
        // etc
      ]);

      // Process locally, report summaries only
      if (metrics.memory.usage > 90) {
        console.warn(`${host}: High memory`);
      }
    }
  }

  Token Savings: 98.7% vs MCP approach

  ### 4. Remove Conflicting MCP Servers

  ```bash
  # Remove system monitoring MCP if you have one
  claude mcp remove system-info  # or whatever it's called

  # Keep Playwright ONLY for dedicated UI testing projects
  claude mcp remove playwright -s user  # Remove from global
  # Only add to UI test projects specifically

  Testing the Setup

  1. Build the monitor:
  cd rust-wasm-monitor
  ./build.sh

  2. Test the demo:
  python3 -m http.server 8080
  # Open http://localhost:8080/demo.html

  3. Use in Claude Code:
  User: "Check system memory on all my servers"

  Claude: I'll use the code-first monitoring approach:
  [Writes TypeScript code that imports from tools/system-monitor]
  [Executes and returns summaries only]
  [Uses ~2,000 tokens instead of ~150,000]

  Summary

  ✅ Use code-first approach for monitoring (this project)
  ✅ Remove global MCP servers you don't always need
  ✅ Load Playwright only in UI-specific projects
  ✅ Add to CLAUDE.md the code-first philosophy
  ✅ Create .claude/tools/ descriptions for discovery
  ✅ Monitor token usage and optimize

  The key insight: AI agents should write code to use tools, not load massive tool definitions. This project demonstrates that
  pattern with 98.7% token savings!

────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
>
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  rust-wasm-monitor [main] • 4.5 • +1834/-2 • $2.92
  ⏵⏵ accept edits on (shift+tab to cycle)



